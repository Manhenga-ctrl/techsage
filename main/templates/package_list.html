{% extends "base.html" %}
{% block title %}Packages - HPE WiFi Portal{% endblock %}

{% block content %}
<h1>PACKAGES</h1>

<div class="controls">
    <input type="text" id="searchPackage" placeholder="Search Packages..." onkeyup="filterTable()">
    <select id="packageFilter" onchange="filterTable()">
        <option value="">All Packages</option>
        {% for p in packages %}
            <option value="{{ p.package }}">{{ p.package }}</option>
        {% endfor %}
    </select>
</div>

<table id="packageTable">
    <thead>
        <tr>
            <th>Amount</th>
            <th>Package</th>
            <th>Created At</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
    {% for package in packages %}
        <tr>
            <td data-label="Amount">{{ package.amount }}</td>
            <td data-label="Package">{{ package.package }}</td>
            <td data-label="Created At">{{ package.created_at|date:"Y-m-d H:i" }}</td>
            <td data-label="Action">
                <form method="post" action="{% url 'delete_package' package.id %}">
                    {% csrf_token %}
                    <button type="submit" class="delete-btn">Delete</button>
                </form>
            </td>
        </tr>
    {% empty %}
        <tr>
            <td colspan="4">No packages found.</td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<script>
function filterTable() {
    const search = document.getElementById("searchPackage").value.toUpperCase();
    const filter = document.getElementById("packageFilter").value.toUpperCase();

    document.querySelectorAll("#packageTable tbody tr").forEach(row => {
        const amount = row.cells[0].innerText.toUpperCase();
        const pkg = row.cells[1].innerText.toUpperCase();
        const show = (amount.includes(search) || pkg.includes(search)) &&
                     (filter === "" || pkg === filter);
        row.style.display = show ? "" : "none";
    });
}
</script>
{% endblock %}
